{"remainingRequest":"C:\\Users\\User\\Desktop\\Happy road\\Happy-road\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\User\\Desktop\\Happy road\\Happy-road\\src\\views\\coupon.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\User\\Desktop\\Happy road\\Happy-road\\src\\views\\coupon.vue","mtime":1560843954949},{"path":"C:\\Users\\User\\Desktop\\Happy road\\Happy-road\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\User\\Desktop\\Happy road\\Happy-road\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\User\\Desktop\\Happy road\\Happy-road\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\User\\Desktop\\Happy road\\Happy-road\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport $ from \"jquery\";\r\nimport Pagination from \"./Pagination\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      isNew: false,\r\n      isLoading: false,\r\n      newtime: new Date(),\r\n      coupons: {},\r\n      pagination: {},\r\n      setcoupon: {\r\n        title: \"\",\r\n        is_enabled: 1,\r\n        percent: 0,\r\n        due_date: 0,\r\n        code: \"\"\r\n      }\r\n    };\r\n  },\r\n  watch: {\r\n    newtime() {\r\n      const vm = this;\r\n      const timestamp = Math.floor(new Date(vm.newtime) / 1000);\r\n      vm.setcoupon.due_date = timestamp;\r\n    }\r\n  },\r\n  components: {\r\n    Pagination\r\n  },\r\n  methods: {\r\n    getcoupon(page = 1) {\r\n      //ES6用法 如果有傳參數近來 使用傳進來的參數 如果沒有 使用預設值1\r\n      const api = `${process.env.VUE_APP_APIPATH}/api/${\r\n        process.env.VUE_APP_COUSTOMPATH\r\n      }/admin/coupons?page=${page}`;\r\n      const vm = this;\r\n      vm.isLoading = true;\r\n      console.log(api);\r\n      this.$http.get(api).then(response => {\r\n        console.log(response.data);\r\n        vm.pagination = response.data.pagination;\r\n        vm.coupons = response.data.coupons;\r\n        vm.isLoading = false;\r\n        /*  if(response.data.success){\r\n        vm.$set(vm.coupons,'coupons',response.coupons) //無get set如要使用v model 要使用強制寫入\r\n        } */\r\n      });\r\n    },\r\n    addcoupon(setcoupon) {\r\n      let api = `${process.env.VUE_APP_APIPATH}/api/${\r\n        process.env.VUE_APP_COUSTOMPATH\r\n      }/admin/coupon`;\r\n      let httpMethos = \"post\";\r\n      const vm = this;\r\n      const coupon = {\r\n        title: setcoupon.title,\r\n        is_enabled: setcoupon.is_enabled,\r\n        percent: setcoupon.percent,\r\n        due_date: setcoupon.due_date,\r\n        code: setcoupon.code\r\n      };\r\n      vm.isLoading = true;\r\n      /*  const timestamp = Math.floor(Date.now() / 1000); */\r\n      if (!vm.isNew) {\r\n        console.log(api);\r\n        httpMethos = \"put\";\r\n        api = `${process.env.VUE_APP_APIPATH}/api/${\r\n          process.env.VUE_APP_COUSTOMPATH\r\n        }/admin/coupon/${vm.setcoupon.id}`;\r\n\r\n        this.$http[httpMethos](api, { data: coupon }).then(response => {\r\n          console.log(api);\r\n          vm.isLoading = false;\r\n          $(\"#couponmodal\").modal(\"hide\");\r\n          this.getcoupon();\r\n        });\r\n      } else {\r\n        this.$http[httpMethos](api, { data: vm.setcoupon }).then(response => {\r\n          console.log(api);\r\n          vm.isLoading = false;\r\n          $(\"#couponmodal\").modal(\"hide\");\r\n          console.log(vm.newtime);\r\n          this.getcoupon();\r\n        });\r\n      }\r\n    },\r\n    delcoupon(id) {\r\n      const api = `${process.env.VUE_APP_APIPATH}/api/${\r\n        process.env.VUE_APP_COUSTOMPATH\r\n      }/admin/coupon/${id}`;\r\n      const vm = this;\r\n      vm.isLoading = true;\r\n      this.$http.delete(api).then(response => {\r\n        console.log(response);\r\n        vm.isLoading = false;\r\n        this.getcoupon();\r\n      });\r\n    },\r\n\r\n    openmodal(isNew, item) {\r\n      const vm = this;\r\n      if (isNew) {\r\n        vm.setcoupon = {};\r\n        vm.newtime = '';\r\n        vm.isNew = true;\r\n      } else {\r\n        vm.setcoupon = Object.assign({}, item);\r\n        vm.newtime = '';\r\n        vm.isNew = false;\r\n      }\r\n      $(\"#couponmodal\").modal(\"show\");\r\n    }\r\n  },\r\n  computed: {\r\n    formatTime() {\r\n      console.log(this.newDate);\r\n      /*  var dates = new Date(this.newDate * 1000);\r\n      var year = dates.getFullYear();\r\n      var month = dates.getMonth() + 1;\r\n      var date = dates.getDate() + 1;\r\n      var hours = dates.getHours();\r\n      var minutes = dates.getMinutes();\r\n      var seconds = dates.getSeconds();\r\n      return `${year}/${month}/${date} ${hours}:${minutes}:${seconds}`; */\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getcoupon();\r\n  }\r\n};\r\n",{"version":3,"sources":["coupon.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8FA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"coupon.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div>\r\n    <loading :active.sync=\"isLoading\"></loading>\r\n    <div class=\"py-4 text-right\">\r\n      <button class=\"btn btn-primary\" @click=\"openmodal(true)\">新增優惠券</button>\r\n    </div>\r\n    <table class=\"table table-hover\">\r\n      <thead>\r\n        <tr>\r\n          <th scope=\"col\">優惠券名稱</th>\r\n          <th scope=\"col\">優惠券代碼</th>\r\n          <th scope=\"col\">到期日</th>\r\n          <th scope=\"col\">折扣數</th>\r\n          <th scope=\"col\" width=\"150\">刪除優惠券</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr v-for=\"item in coupons\" :key=\"item.id\">\r\n          <td>{{item.title}}</td>\r\n          <td>{{item.code}}</td>\r\n          <td>{{item.due_date |normaltime}}</td>\r\n          <td>{{item.percent}}%</td>\r\n          <td>\r\n            <button class=\"btn btn-outline-primary btn-sm mr-2\" @click=\"openmodal(false,item)\">修改</button>\r\n            <button class=\"btn btn-outline-danger btn-sm\" @click=\"delcoupon(item.id)\">刪除</button>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    <Pagination :pages=\"pagination\" @returnPageData=\"getcoupon\"></Pagination>\r\n\r\n    <div class=\"modal\" tabindex=\"-1\" role=\"dialog\" id=\"couponmodal\">\r\n      <div class=\"modal-dialog\" role=\"document\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\">新增優惠券</h5>\r\n            <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n              <span aria-hidden=\"true\">&times;</span>\r\n            </button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <div class=\"form-group\">\r\n              <label for=\"coupon-title\">請輸入優惠券名稱</label>\r\n              <input\r\n                type=\"text\"\r\n                class=\"form-control mt-2\"\r\n                id=\"coupon-title\"\r\n                placeholder=\"優惠券名稱\"\r\n                v-model=\"setcoupon.title\"\r\n              >\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"coupon-title\">請輸入優惠券到期日</label>\r\n              <input\r\n                type=\"date\"\r\n                class=\"form-control mt-2\"\r\n                id=\"coupon-title\"\r\n                placeholder=\"優惠券到期日\"\r\n                v-model=\"newtime\"\r\n              >\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"coupon-title\">請輸入折扣%數</label>\r\n              <input\r\n                type=\"number\"\r\n                class=\"form-control mt-2\"\r\n                id=\"coupon-title\"\r\n                placeholder\r\n                v-model=\"setcoupon.percent\"\r\n                oninput=\"if(value<0) value=1;if(value>100)value=100\"\r\n              >\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label for=\"coupon-title\">請輸入優惠券使用代碼</label>\r\n              <input\r\n                type=\"text\"\r\n                class=\"form-control mt-2\"\r\n                id=\"coupon-title\"\r\n                placeholder\r\n                v-model=\"setcoupon.code\"\r\n              >\r\n            </div>\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">關閉</button>\r\n            <button type=\"button\" class=\"btn btn-primary\" @click=\"addcoupon(setcoupon)\">確認</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport $ from \"jquery\";\r\nimport Pagination from \"./Pagination\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      isNew: false,\r\n      isLoading: false,\r\n      newtime: new Date(),\r\n      coupons: {},\r\n      pagination: {},\r\n      setcoupon: {\r\n        title: \"\",\r\n        is_enabled: 1,\r\n        percent: 0,\r\n        due_date: 0,\r\n        code: \"\"\r\n      }\r\n    };\r\n  },\r\n  watch: {\r\n    newtime() {\r\n      const vm = this;\r\n      const timestamp = Math.floor(new Date(vm.newtime) / 1000);\r\n      vm.setcoupon.due_date = timestamp;\r\n    }\r\n  },\r\n  components: {\r\n    Pagination\r\n  },\r\n  methods: {\r\n    getcoupon(page = 1) {\r\n      //ES6用法 如果有傳參數近來 使用傳進來的參數 如果沒有 使用預設值1\r\n      const api = `${process.env.VUE_APP_APIPATH}/api/${\r\n        process.env.VUE_APP_COUSTOMPATH\r\n      }/admin/coupons?page=${page}`;\r\n      const vm = this;\r\n      vm.isLoading = true;\r\n      console.log(api);\r\n      this.$http.get(api).then(response => {\r\n        console.log(response.data);\r\n        vm.pagination = response.data.pagination;\r\n        vm.coupons = response.data.coupons;\r\n        vm.isLoading = false;\r\n        /*  if(response.data.success){\r\n        vm.$set(vm.coupons,'coupons',response.coupons) //無get set如要使用v model 要使用強制寫入\r\n        } */\r\n      });\r\n    },\r\n    addcoupon(setcoupon) {\r\n      let api = `${process.env.VUE_APP_APIPATH}/api/${\r\n        process.env.VUE_APP_COUSTOMPATH\r\n      }/admin/coupon`;\r\n      let httpMethos = \"post\";\r\n      const vm = this;\r\n      const coupon = {\r\n        title: setcoupon.title,\r\n        is_enabled: setcoupon.is_enabled,\r\n        percent: setcoupon.percent,\r\n        due_date: setcoupon.due_date,\r\n        code: setcoupon.code\r\n      };\r\n      vm.isLoading = true;\r\n      /*  const timestamp = Math.floor(Date.now() / 1000); */\r\n      if (!vm.isNew) {\r\n        console.log(api);\r\n        httpMethos = \"put\";\r\n        api = `${process.env.VUE_APP_APIPATH}/api/${\r\n          process.env.VUE_APP_COUSTOMPATH\r\n        }/admin/coupon/${vm.setcoupon.id}`;\r\n\r\n        this.$http[httpMethos](api, { data: coupon }).then(response => {\r\n          console.log(api);\r\n          vm.isLoading = false;\r\n          $(\"#couponmodal\").modal(\"hide\");\r\n          this.getcoupon();\r\n        });\r\n      } else {\r\n        this.$http[httpMethos](api, { data: vm.setcoupon }).then(response => {\r\n          console.log(api);\r\n          vm.isLoading = false;\r\n          $(\"#couponmodal\").modal(\"hide\");\r\n          console.log(vm.newtime);\r\n          this.getcoupon();\r\n        });\r\n      }\r\n    },\r\n    delcoupon(id) {\r\n      const api = `${process.env.VUE_APP_APIPATH}/api/${\r\n        process.env.VUE_APP_COUSTOMPATH\r\n      }/admin/coupon/${id}`;\r\n      const vm = this;\r\n      vm.isLoading = true;\r\n      this.$http.delete(api).then(response => {\r\n        console.log(response);\r\n        vm.isLoading = false;\r\n        this.getcoupon();\r\n      });\r\n    },\r\n\r\n    openmodal(isNew, item) {\r\n      const vm = this;\r\n      if (isNew) {\r\n        vm.setcoupon = {};\r\n        vm.newtime = '';\r\n        vm.isNew = true;\r\n      } else {\r\n        vm.setcoupon = Object.assign({}, item);\r\n        vm.newtime = '';\r\n        vm.isNew = false;\r\n      }\r\n      $(\"#couponmodal\").modal(\"show\");\r\n    }\r\n  },\r\n  computed: {\r\n    formatTime() {\r\n      console.log(this.newDate);\r\n      /*  var dates = new Date(this.newDate * 1000);\r\n      var year = dates.getFullYear();\r\n      var month = dates.getMonth() + 1;\r\n      var date = dates.getDate() + 1;\r\n      var hours = dates.getHours();\r\n      var minutes = dates.getMinutes();\r\n      var seconds = dates.getSeconds();\r\n      return `${year}/${month}/${date} ${hours}:${minutes}:${seconds}`; */\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getcoupon();\r\n  }\r\n};\r\n</script>\r\n"]}]}